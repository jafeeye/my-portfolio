[{"content":"CML\r簡介\r新版CML採用Ubuntu 24.10發行版製作，原理是開機先將cml_2.9.1xx.iso進行掛載，此時會自動進行安裝程式把cml跟GRUB安裝好，在第二次開機會出現GRUB的CML選單，接續才進行帳號及IP位置初始化設定。\nBIOS：OVMF (UEFI)\n硬碟：EFI Disk (預設大小)、Hard Disk (scsi0)100G，並設定Async IO為native\nCD/DVD (ide0)：cml_2.9.1xx.iso (第一次自動安裝完可以移除)\nCD/DVD (ide1)：refplat-20250616-fcs.iso\n.\nNested ESXi\r簡介\r安裝嵌套式ESXi，要在PVE中啟用Enable NUMA，才能進入使用畫面\n類型 設定 Processors Type Host、Enable NUMA BIOS Type SeaBIOS Network Type VMware vmxnet3 GNS3\r類型 設定 Processors Type Host BIOS Type SeaBIOS Network Type VirtIO Disk Not add 1.在 Github 下載 GNS3.VM.KVM.3.x.x.zip，並使用scp把檔案上傳至/var/lib/vz/images，因為qcow2在proxmox無法直接使用，需匯入指令\n1 2 3 4 qm importdisk \u0026lt;vmid\u0026gt; \u0026lt;path/xxxx.qcow2\u0026gt; \u0026lt;storage\u0026gt; qm importdisk 134 /var/lib/vz/images/GNS3_VM-disk001.qcow2 local qm importdisk 134 /var/lib/vz/images/GNS3_VM-disk002.qcow2 local rm -rf /var/lib/vz/images/GNS3_VM-disk00x.qcow2 2.匯入成功後出現unused disk，按edit在BUS/Device選擇Virto Block，再按add完成 3.在Option把 Boot Order中把硬碟打勾並移動開機順序才能開機 VyOS\r","date":"2026-02-17T00:00:00Z","permalink":"http://localhost:1313/my-portfolio/p/pve-%E5%AE%89%E8%A3%9Dcml-esxi/","title":"PVE 安裝CML ESXi"},{"content":"VM 環境\nAD+CA：192.168.80.10 VMNet8 NAT 192.168.80.0/24 RADIUS：192.168.80.11 VMNet8 NAT 192.168.80.0/24 VPN：192.168.80.13 VMNet9 Host-Only 192.168.90.0/24 Host IP 乙太網路：192.168.8.6 測試端口轉發 VM：ncat -u -l 2300 -u 為發出udp，無指定為tcp Host: ncat 192.168.8.50 2300\n※有時候VMware Workstation 端口轉發會失敗，重新啟動服務\n設定802.1X Wireless AP及VPN\r(1) 連線要求原則及網路原則都有順序，要把安全無線跟VPN處理順序放置在最上方 (2) NPS(主機)/標準設定/802.1X或VPN進入精靈畫面設定，使用精靈畫面設定結束有時會出現2個用戶端，刪掉一個重複就好 (3) 連線要求原則\nVPN\r條件:NAS連接，802.1X為無線-IEEE 802.11,無線-其他 設定:驗證方法為空不能打勾\n802.1X\r條件:NAS連接，802.1X為無線-IEEE 802.11,無線-其他 設定:驗證方法為空不能打勾\n(4) 網路原則\n設定VPN Server\rVPN Server 串接Radius Sever 容易有bug，記得在VPN Server 改 RADIUS Secret 後要切回 Windows Auth 再改回 RADIUS (原因在於RRAS 使用 RADIUS 會快取 Shared Secret，舊的 Secret 不會被清掉)\n1 2 net stop ias \u0026amp; net start ias net stop remoteaccess \u0026amp; net start remoteaccess 設定連線\r1.802.1X Wireless AP 2.VPN連線 ","date":"2026-01-05T00:00:00Z","permalink":"http://localhost:1313/my-portfolio/p/radius-%E4%BC%81%E6%A5%AD%E9%A9%97%E8%AD%89%E4%BC%BA%E6%9C%8D%E5%99%A8%E6%9E%B6%E8%A8%AD/","title":"Radius 企業驗證伺服器架設 "},{"content":"一、設定AD主機\r1. AD 主機安裝功能：新增角色功能：AD網域服務、DHCP伺服器、DNS伺服器\n2. 設定DNS功能\n3.設定DHCP：設定發IP的範圍，這邊範圍是192.168.80-254，因為AD這台當DHCP Server，所以關掉WDS 發DHCP，從這邊直接指定PXE參數\n4.DHCP設定完如下\n5.記得啟動服務\n二、 設定WDS主機\r１.安裝WDS服務\n2.安裝相關軟體\nWindows ADK Windows ADK PE 附加元件 Microsoft Deployment Toolkit 三、 設定MDT\r甲.CustomSettings.ini\r程式碼\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 [Settings] Priority=Default Properties=MyCustomProperty [Default] OSInstall=Y SkipCapture=YES SkipAdminPassword=YES SkipProductKey=YES SkipComputerBackup=YES SkipBitLocker=YES SkipTaskSequence=YES TaskSequenceID=WIN11-1 //要注意設定：CMD畫面 SkipComputerName=YES OSDComputerName=PC#Left(\u0026#34;%UUID%\u0026#34;,6)# SkipUserData=YES SkipLocaleSelection=YES SkipSummary=YES ~ 跳過加入Domain 域畫面~ SkipDomainMembership=YES JoinDomain=pin.local DomainAdmin=administrator DomainAdminDomain=pin.local DomainAdminPassword=2Password! ~ 跳過地區設定畫面 ~ SkipTimeZone=YES TimeZoneName=Taipei Standard Time KeyboardLocale=0404:00000404 UserLocale=zh-TW UILanguage=zh-TW ~ 跳過自動安裝軟體畫面~ SkipApplications=YES Applications001={8f9c6698-d45d-47fe-ae1e-fd218ac13770} Applications002={0b73d65b-42dc-4b87-8ca4-b6b46a9fbccc} Applications003={44db7120-0efc-4e77-9953-5ec38955c6fb} ApplyGPOPack=NO //此行可以設定Local GPO，但實務上少用 乙. Bootstrap.ini\r程式碼\n1 2 3 4 5 6 7 8 9 [Settings] Priority=Default [Default] DeployRoot=\\\\WDS\\DeploymentShare$ UserDomain=pin.local UserID=administrator UserPassword=2Password! SkipBDDWelcome=YES KeyBoardLocale=en-us 從這邊可以刪掉部屬不需要的選項\n丙、自動安裝Script\r程式碼 大量命名電腦 加入AD域電腦名稱亂數避免重複 ：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 VM UUID：OSDComputerName=PC#Left(\u0026#34;%UUID%\u0026#34;,6)# PC MAC：OSDComputerName=PC#Right(\u0026#34;%MACADDRESS%\u0026#34;,6)# 桌布 (Powershell) $wallpaperPath = \u0026#34;C:\\Windows\\wallpaper.jpg\u0026#34; Copy-Item \u0026#34;$PSScriptRoot\\wallpaper.jpg\u0026#34; -Destination $wallpaperPath -Force Add-Type @\u0026#34; using System.Runtime.InteropServices; public class Wallpaper { [DllImport(\u0026#34;user32.dll\u0026#34;, SetLastError = true)] public static extern bool SystemParametersInfo(int uAction, int uParam, string lpvParam, int fuWinIni); } \u0026#34;@ # SPI_SETDESKWALLPAPER = 20, SPIF_UPDATEINIFILE = 0x01, SPIF_SENDWININICHANGE = 0x02 [Wallpaper]::SystemParametersInfo(20, 0, $wallpaperPath, 1 -bor 2) 部屬APP\n1 2 3 ChromeSetup.exe /S msiexec /i 7z2501-x64.msi /quiet msiexec /i LibreOffice_25.8.2_Win_x86-64.msi /quiet 四、啟動MDT\r1.新增做好的MDT映像檔\n2.將預設PXE選項調整\n3.最後啟動就可進行大量安裝作業\n五、已知問題\r**1.****確保權限有被分享 (****需要手動設定開UNC$**權限)\n程式碼\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 # Check for elevation Write-Host \u0026#34;Checking for elevation\u0026#34; If (-NOT ([Security.Principal.WindowsPrincipal] [Security.Principal.WindowsIdentity]::GetCurrent()).IsInRole(` [Security.Principal.WindowsBuiltInRole] \u0026#34;Administrator\u0026#34;)) { Write-Warning \u0026#34;需要以系統管理員執行腳本.\u0026#34; Write-Warning \u0026#34;Aborting script...\u0026#34; Break } # Configure NTFS Permissions for the DeploymentShare deployment share $DeploymentShareNTFS = \u0026#34;D:\\ DeploymentShare\u0026#34; icacls $DeploymentShareNTFS /grant \u0026#39;\u0026#34;pin.local\\MDT_BA\u0026#34;:(OI)(CI)(RX)\u0026#39; icacls $DeploymentShareNTFS /grant \u0026#39;\u0026#34;Administrators\u0026#34;:(OI)(CI)(F)\u0026#39; icacls $DeploymentShareNTFS /grant \u0026#39;\u0026#34;SYSTEM\u0026#34;:(OI)(CI)(F)\u0026#39; icacls \u0026#34;$DeploymentShareNTFS\\Captures\u0026#34; /grant \u0026#39;\u0026#34;pin.local\\MDT_BA\u0026#34;:(OI)(CI)(M)\u0026#39; # Configure Sharing Permissions for the DeploymentShare deployment share $DeploymentShare = \u0026#34; DeploymentShare $\u0026#34; Grant-SmbShareAccess -Name $DeploymentShare -AccountName \u0026#34;EVERYONE\u0026#34; -AccessRight Change -Force Revoke-SmbShareAccess -Name $DeploymentShare -AccountName \u0026#34;CREATOR OWNER\u0026#34; -Force 2.無法執行PXE Boot (MS已知Bug)\nWDS 部屬伺服器將開機檔複製到RemoteInstall 缺了wdsmgfw.efi\n要到 C:/Windows/System32/Reminst ..複製一份過去\n**3.**防火牆放行\nnetsh advfirewall firewall add rule name=\u0026ldquo;WDS TFTP\u0026rdquo; dir=in action=allow protocol=UDP localport=69\n4.MDT選項中MMC錯誤 (MS****已知Bug)\n因為在最新ADK 10.1.26100.2454 (2024年12月)取消對PE x86的支持，但有些設定又需動到，C:\\Program Files (x86)\\Windows Kits\\10\\Assessment and Deployment Kit\\Windows Preinstallation Environment\\x86\\WinPE_OCs 複製上一層x64檔案過來避掉錯誤(超無言)\n5.VM超多台PXE開機出現0xc0000001****無法啟動 問題連結\n在虛擬機模擬多台VM(2台以上)情況可能出現，因為Buffer吃滿直接報錯，真實環境較不會遇到。\n六、結語\r使用MDT+WDS是目前企業常見免費大量部屬方案，如果更大型企業會使用Microsoft SCCM(需要授權費)，企業可針對內部需求選擇最有利的方案。\n七、參考資料\rMDT8456部署Windows系列，https://blog.51cto.com/jasonhuang/\n微軟WDS+MDT+WSUS實現系統自動化部署，https://www.zhihu.com/tardis/zm/art/17319155423?source_id=1003\nMicrosoft 官方，https://www.micsorft.com\n","date":"2026-01-05T00:00:00Z","permalink":"http://localhost:1313/my-portfolio/p/wds-mdt-%E4%BC%81%E6%A5%AD%E5%A4%A7%E9%87%8F%E8%87%AA%E5%8B%95%E9%83%A8%E5%B1%AC/","title":"WDS+MDT 企業大量自動部屬"}]